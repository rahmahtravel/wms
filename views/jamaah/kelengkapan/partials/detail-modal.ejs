<!-- Detail Modal -->
<style>
  .detail-item-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }
  
  .detail-item-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.6s;
    z-index: 1;
  }
  
  .detail-item-card:hover::before {
    left: 100%;
  }
  
  .detail-item-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 8px 16px rgba(0, 0, 0, 0.1);
  }
  
  .detail-badge {
    animation: pulse-glow 3s ease-in-out infinite;
  }
  
  @keyframes pulse-glow {
    0%, 100% { 
      opacity: 1; 
      box-shadow: 0 0 0 rgba(59, 130, 246, 0);
    }
    50% { 
      opacity: 0.9; 
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* Responsive Grid Enhancements */
  @media (max-width: 640px) {
    .detail-item-card {
      padding: 1rem;
    }
  }
  
  @media (max-width: 480px) {
    .detail-item-card {
      margin-bottom: 0.5rem;
    }
  }
  
  /* Enhanced Category Header Animation */
  .category-header {
    background-attachment: fixed;
    position: relative;
  }
  
  .category-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
    animation: shimmer 3s infinite;
  }
  
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  /* Smooth entrance animations */
  .fade-in-up {
    animation: fadeInUp 0.6s ease-out forwards;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Staggered animation for items */
  .detail-item-card:nth-child(1) { animation-delay: 0.1s; }
  .detail-item-card:nth-child(2) { animation-delay: 0.2s; }
  .detail-item-card:nth-child(3) { animation-delay: 0.3s; }
  .detail-item-card:nth-child(4) { animation-delay: 0.4s; }
  .detail-item-card:nth-child(5) { animation-delay: 0.5s; }
  .detail-item-card:nth-child(6) { animation-delay: 0.6s; }
  .detail-item-card:nth-child(7) { animation-delay: 0.7s; }
  .detail-item-card:nth-child(8) { animation-delay: 0.8s; }
  
  /* Mobile optimizations */
  @media (max-width: 768px) {
    .category-header {
      padding: 1rem;
    }
    
    .detail-item-card {
      transform: none;
      transition: box-shadow 0.3s ease;
    }
    
    .detail-item-card:hover {
      transform: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  }
</style>

<div id="detailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
  <div class="relative top-4 md:top-10 mx-auto p-4 md:p-6 border w-full md:w-11/12 lg:w-4/5 xl:w-3/4 2xl:w-2/3 shadow-2xl rounded-lg md:rounded-xl bg-white max-h-[95vh] md:max-h-[90vh] flex flex-col">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6 flex-shrink-0 border-b pb-4">
      <div class="flex items-center space-x-3">
        <div class="bg-blue-500 text-white p-3 rounded-full">
          <i class="fas fa-info-circle text-lg"></i>
        </div>
        <div>
          <h3 class="text-xl md:text-2xl font-bold text-gray-900">Detail Kelengkapan Jamaah</h3>
          <p class="text-sm text-gray-600 mt-1">Informasi lengkap jamaah dan barang kelengkapan</p>
        </div>
      </div>
      <button onclick="closeDetailModal()" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 transition">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>
    
    <!-- Loading State -->
    <div id="detailLoading" class="flex justify-center items-center py-12 hidden">
      <div class="flex flex-col items-center space-y-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
        <span class="text-gray-600 font-medium">Memuat detail kelengkapan...</span>
      </div>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto" id="detailContent" style="display: none;">
      
      <!-- Jamaah Information Card -->
      <div class="relative overflow-hidden bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-2xl p-6 mb-8 border border-blue-200 shadow-lg">
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full transform translate-x-16 -translate-y-16 opacity-10"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full transform -translate-x-12 translate-y-12 opacity-10"></div>
        
        <div class="relative z-10">
          <div class="flex items-center mb-6">
            <div class="bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-4 rounded-xl mr-4 shadow-lg">
              <i class="fas fa-user text-2xl"></i>
            </div>
            <div>
              <h4 class="text-xl font-bold text-gray-900 mb-1">Informasi Jamaah</h4>
              <p class="text-sm text-gray-600">Data pribadi dan kontak jamaah</p>
            </div>
          </div>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="bg-white bg-opacity-80 backdrop-blur-sm rounded-xl p-5 border border-white border-opacity-50 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
              <div class="flex items-center space-x-4">
                <div class="bg-gradient-to-br from-blue-100 to-blue-200 text-blue-600 p-3 rounded-xl">
                  <i class="fas fa-id-badge text-lg"></i>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 uppercase tracking-widest font-medium mb-1">Nama Jamaah</p>
                  <p id="detailNamaJamaah" class="font-bold text-gray-900 text-sm truncate">-</p>
                </div>
              </div>
            </div>
            
            <div class="bg-white bg-opacity-80 backdrop-blur-sm rounded-xl p-5 border border-white border-opacity-50 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
              <div class="flex items-center space-x-4">
                <div class="bg-gradient-to-br from-green-100 to-emerald-200 text-green-600 p-3 rounded-xl">
                  <i class="fas fa-phone text-lg"></i>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 uppercase tracking-widest font-medium mb-1">No. Telepon</p>
                  <p id="detailNoTelp" class="font-bold text-gray-900 text-sm truncate">-</p>
                </div>
              </div>
            </div>
            
            <div class="bg-white bg-opacity-80 backdrop-blur-sm rounded-xl p-5 border border-white border-opacity-50 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1 sm:col-span-2 lg:col-span-1">
              <div class="flex items-center space-x-4">
                <div class="bg-gradient-to-br from-purple-100 to-pink-200 text-purple-600 p-3 rounded-xl">
                  <i class="fas fa-calendar-alt text-lg"></i>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-gray-500 uppercase tracking-widest font-medium mb-1">Tanggal Keberangkatan</p>
                  <p id="detailTanggalKeberangkatan" class="font-bold text-gray-900 text-sm truncate">-</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Pengambilan Card -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <div class="bg-orange-500 text-white p-3 rounded-full mr-4">
              <i class="fas fa-clipboard-check text-xl"></i>
            </div>
            <div>
              <h4 class="text-lg font-bold text-gray-900">Status Pengambilan</h4>
              <p class="text-sm text-gray-600">Status saat ini kelengkapan jamaah</p>
            </div>
          </div>
          <div id="detailStatusBadge" class="detail-badge">
            <!-- Status badge will be inserted here -->
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-50 rounded-lg p-4">
            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Tanggal Dibuat</p>
            <p id="detailTanggalDibuat" class="font-semibold text-gray-900">-</p>
          </div>
          <div class="bg-gray-50 rounded-lg p-4">
            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Catatan</p>
            <p id="detailCatatan" class="font-semibold text-gray-900">-</p>
          </div>
        </div>
      </div>

      <!-- Items List Card -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <div class="bg-green-500 text-white p-3 rounded-full mr-4">
              <i class="fas fa-list-check text-xl"></i>
            </div>
            <div>
              <h4 class="text-lg font-bold text-gray-900">Barang Kelengkapan</h4>
              <p class="text-sm text-gray-600">Daftar barang yang sudah dipilih untuk jamaah</p>
            </div>
          </div>
          <div class="text-right">
            <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
              <span class="text-sm font-semibold">Total: <span id="detailTotalItems">0</span> item</span>
            </div>
          </div>
        </div>

        <!-- Items Container -->
        <div id="detailItemsContainer">
          <!-- Items will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="detailEmptyState" class="text-center py-12 hidden">
          <div class="bg-gray-50 rounded-lg p-8">
            <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
            <h5 class="text-lg font-semibold text-gray-900 mb-2">Belum Ada Barang Dipilih</h5>
            <p class="text-gray-600">Jamaah ini belum memiliki barang kelengkapan yang dipilih</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="flex justify-between items-center pt-6 mt-6 border-t border-gray-200 flex-shrink-0" id="detailFooter" style="display: none;">
      <div class="text-sm text-gray-600">
        <i class="fas fa-info-circle mr-1"></i>
        Detail kelengkapan jamaah
      </div>
      <div class="flex space-x-3">
        <button type="button" onclick="closeDetailModal()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
          <i class="fas fa-times mr-2"></i>Tutup
        </button>
        <button type="button" onclick="openItemsModalFromDetail()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
          <i class="fas fa-edit mr-2"></i>Edit Kelengkapan
        </button>
      </div>
    </div>
  </div>
</div>

<script>
let currentDetailKelengkapanId = null;

function openDetailModal(kelengkapanId) {
  currentDetailKelengkapanId = kelengkapanId;
  
  const modal = document.getElementById('detailModal');
  const loading = document.getElementById('detailLoading');
  const content = document.getElementById('detailContent');
  const footer = document.getElementById('detailFooter');
  
  // Show modal and loading state
  modal.classList.remove('hidden');
  loading.classList.remove('hidden');
  content.style.display = 'none';
  footer.style.display = 'none';
  
  // Load detail data
  loadDetailData();
}

function closeDetailModal() {
  document.getElementById('detailModal').classList.add('hidden');
  currentDetailKelengkapanId = null;
  
  // Reset content
  document.getElementById('detailItemsContainer').innerHTML = '';
  document.getElementById('detailTotalItems').textContent = '0';
}

async function loadDetailData() {
  try {
    console.log('Loading detail for kelengkapan ID:', currentDetailKelengkapanId);
    
    // Load kelengkapan data and selected items
    const [kelengkapanResponse, itemsResponse] = await Promise.all([
      fetch(`/jamaah/kelengkapan/${currentDetailKelengkapanId}/status`),
      fetch(`/jamaah/kelengkapan/${currentDetailKelengkapanId}/items`)
    ]);
    
    if (!kelengkapanResponse.ok) {
      throw new Error(`Failed to fetch kelengkapan: ${kelengkapanResponse.status}`);
    }
    if (!itemsResponse.ok) {
      throw new Error(`Failed to fetch items: ${itemsResponse.status}`);
    }
    
    const kelengkapanData = await kelengkapanResponse.json();
    const selectedItems = await itemsResponse.json();
    
    console.log('Kelengkapan data:', kelengkapanData);
    console.log('Selected items:', selectedItems);
    
    // Display jamaah information
    displayDetailJamaahInfo(kelengkapanData);
    
    // Display selected items
    displayDetailItems(selectedItems);
    
    // Show content
    document.getElementById('detailLoading').classList.add('hidden');
    document.getElementById('detailContent').style.display = 'block';
    document.getElementById('detailFooter').style.display = 'flex';
    
  } catch (error) {
    console.error('Error loading detail data:', error);
    
    // Show error state
    document.getElementById('detailLoading').innerHTML = `
      <div class="text-center text-red-600">
        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
        <h5 class="text-lg font-semibold mb-2">Gagal Memuat Detail</h5>
        <p class="text-sm">${error.message}</p>
        <button onclick="loadDetailData()" class="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
          <i class="fas fa-retry mr-2"></i>Coba Lagi
        </button>
      </div>
    `;
  }
}

function displayDetailJamaahInfo(data) {
  // Update jamaah information
  document.getElementById('detailNamaJamaah').textContent = data.nama_jamaah || 'Tidak tersedia';
  document.getElementById('detailNoTelp').textContent = data.nomor_telp || 'Tidak tersedia';
  document.getElementById('detailTanggalKeberangkatan').textContent = data.tanggal_keberangkatan ? 
    new Date(data.tanggal_keberangkatan).toLocaleDateString('id-ID', { 
      day: '2-digit', 
      month: 'long', 
      year: 'numeric' 
    }) : 'Tidak tersedia';
  
  // Update status badge
  const statusBadge = document.getElementById('detailStatusBadge');
  const status = data.status_pengambilan || 'Belum Diambil';
  
  let statusClass = '';
  let statusIcon = '';
  
  switch (status) {
    case 'Sudah Diambil':
      statusClass = 'bg-green-100 text-green-800';
      statusIcon = 'fas fa-check-circle';
      break;
    case 'Di Kirim':
      statusClass = 'bg-blue-100 text-blue-800';
      statusIcon = 'fas fa-shipping-fast';
      break;
    case 'Di Ambil Di Kantor':
      statusClass = 'bg-purple-100 text-purple-800';
      statusIcon = 'fas fa-building';
      break;
    default:
      statusClass = 'bg-red-100 text-red-800';
      statusIcon = 'fas fa-clock';
  }
  
  statusBadge.innerHTML = `
    <span class="px-4 py-2 inline-flex text-sm leading-5 font-semibold rounded-full ${statusClass}">
      <i class="${statusIcon} mr-2"></i> ${status}
    </span>
  `;
  
  // Update additional info
  document.getElementById('detailTanggalDibuat').textContent = data.created_at ? 
    new Date(data.created_at).toLocaleDateString('id-ID') : 'Tidak tersedia';
  document.getElementById('detailCatatan').textContent = data.catatan || 'Tidak ada catatan';
}

function displayDetailItems(items) {
  const container = document.getElementById('detailItemsContainer');
  const emptyState = document.getElementById('detailEmptyState');
  const totalItems = document.getElementById('detailTotalItems');
  
  if (!items || items.length === 0) {
    container.innerHTML = '';
    emptyState.classList.remove('hidden');
    totalItems.textContent = '0';
    return;
  }
  
  emptyState.classList.add('hidden');
  totalItems.textContent = items.length;
  
  // Group items by category
  const groupedItems = groupDetailItemsByCategory(items);
  
  let html = '';
  
  Object.entries(groupedItems).forEach(([categoryName, categoryData]) => {
    if (categoryData.items.length === 0) return;
    
    html += `
      <div class="mb-8">
        <!-- Category Header - Enhanced Design -->
        <div class="category-header relative overflow-hidden bg-gradient-to-br from-${categoryData.color}-500 via-${categoryData.color}-600 to-${categoryData.color}-700 rounded-2xl mb-6 shadow-lg">
          <div class="absolute inset-0 bg-white bg-opacity-10 backdrop-blur-sm"></div>
          <div class="absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-5 rounded-full transform translate-x-16 -translate-y-16"></div>
          <div class="absolute bottom-0 left-0 w-24 h-24 bg-white bg-opacity-5 rounded-full transform -translate-x-12 translate-y-12"></div>
          
          <div class="relative p-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <div class="bg-white bg-opacity-20 backdrop-blur-sm p-3 rounded-xl shadow-lg border border-white border-opacity-20">
                  <i class="${categoryData.icon} text-2xl text-white"></i>
                </div>
                <div>
                  <h5 class="font-bold text-xl text-white mb-1">${categoryName}</h5>
                  <div class="flex items-center space-x-3">
                    <span class="text-${categoryData.color}-100 text-sm font-medium">${categoryData.items.length} item dipilih</span>
                    <span class="w-1 h-1 bg-${categoryData.color}-200 rounded-full"></span>
                    <span class="text-${categoryData.color}-100 text-sm">Lengkap</span>
                  </div>
                </div>
              </div>
              <div class="bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-xl border border-white border-opacity-20">
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                  <span class="text-white font-bold text-lg">${categoryData.items.length}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Items Grid - Enhanced Layout -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 md:gap-6">
    `;
    
    categoryData.items.forEach((item, index) => {
      html += `
        <div class="detail-item-card group relative bg-white border-2 border-gray-100 rounded-2xl p-5 hover:border-${categoryData.color}-300 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 hover:scale-[1.02]">
          <!-- Card Background Pattern -->
          <div class="absolute inset-0 bg-gradient-to-br from-gray-50 to-white rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          
          <!-- Content -->
          <div class="relative z-10">
            <!-- Header with badges -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex flex-col space-y-2">
                <span class="inline-flex items-center px-3 py-1.5 rounded-xl text-xs font-semibold bg-gradient-to-r from-${categoryData.color}-100 to-${categoryData.color}-200 text-${categoryData.color}-700 border border-${categoryData.color}-200">
                  <i class="fas fa-tag mr-1.5"></i>${item.kode_barang}
                </span>
                ${item.is_required === 1 || item.is_required === '1' ? `
                  <span class="inline-flex items-center px-3 py-1.5 rounded-xl text-xs font-semibold bg-gradient-to-r from-red-100 to-pink-100 text-red-700 border border-red-200 animate-pulse">
                    <i class="fas fa-star mr-1.5 text-yellow-500"></i>Wajib
                  </span>
                ` : `
                  <span class="inline-flex items-center px-3 py-1.5 rounded-xl text-xs font-medium bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-600 border border-blue-100">
                    <i class="fas fa-circle mr-1.5"></i>Opsional
                  </span>
                `}
              </div>
              
              <!-- Item Number -->
              <div class="bg-${categoryData.color}-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shadow-lg">
                ${index + 1}
              </div>
            </div>
            
            <!-- Item Name -->
            <h6 class="font-bold text-gray-900 text-sm leading-tight mb-4 line-clamp-2 group-hover:text-${categoryData.color}-700 transition-colors duration-200">
              ${item.nama_barang}
            </h6>
            
            <!-- Item Details -->
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                <div class="flex items-center space-x-2">
                  <div class="bg-${categoryData.color}-100 text-${categoryData.color}-600 p-1.5 rounded-lg">
                    <i class="fas fa-cube text-xs"></i>
                  </div>
                  <span class="text-xs font-medium text-gray-700">Satuan</span>
                </div>
                <span class="text-xs font-semibold text-gray-900">${item.satuan}</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                <div class="flex items-center space-x-2">
                  <div class="bg-green-100 text-green-600 p-1.5 rounded-lg">
                    <i class="fas fa-check-circle text-xs"></i>
                  </div>
                  <span class="text-xs font-medium text-green-700">Status</span>
                </div>
                <div class="flex items-center space-x-1">
                  <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                  <span class="text-xs font-semibold text-green-700">Terpilih</span>
                </div>
              </div>
            </div>
            
            <!-- Selection Indicator -->
            <div class="mt-4 pt-4 border-t border-gray-100">
              <div class="flex items-center justify-center space-x-2 p-2 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl text-white shadow-md">
                <i class="fas fa-shield-check text-sm"></i>
                <span class="text-xs font-semibold">Sudah Dipilih</span>
              </div>
            </div>
          </div>
          
          <!-- Hover Effect Overlay -->
          <div class="absolute inset-0 bg-gradient-to-br from-${categoryData.color}-500 to-${categoryData.color}-600 rounded-2xl opacity-0 group-hover:opacity-5 transition-opacity duration-300"></div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
  
  // Add entrance animations to cards
  setTimeout(() => {
    const cards = container.querySelectorAll('.detail-item-card');
    cards.forEach((card, index) => {
      card.classList.add('fade-in-up');
      card.style.animationDelay = `${index * 0.1}s`;
    });
  }, 100);
}

function groupDetailItemsByCategory(items) {
  const groups = {
    'Perlengkapan Umroh': {
      icon: 'fas fa-luggage-cart',
      color: 'emerald',
      items: []
    },
    'Laki - Laki': {
      icon: 'fas fa-male',
      color: 'blue',
      items: []
    },
    'Perempuan': {
      icon: 'fas fa-female',
      color: 'pink',
      items: []
    },
    'Jaket': {
      icon: 'fas fa-tshirt',
      color: 'purple',
      items: []
    }
  };
  
  const perlengkapanItems = [
    'bantal leher', 'buku doa', 'congratulation', 'certificate', 'koper 24 inch', 'gold', 
    'syal', 'tas paspor', 'tas serut', 'sepatu'
  ];
  
  const lakiItems = ['kain ihrom anak', 'kain ihrom dewasa', 'ihrom anak', 'ihrom dewasa'];
  const perempuanItems = ['jilbab', 'mukena', 'mukena anak', 'mukena dewasa'];
  
  items.forEach(item => {
    const itemName = item.nama_barang.toLowerCase();
    
    if (itemName.includes('jaket')) {
      groups['Jaket'].items.push(item);
    } else if (lakiItems.some(keyword => itemName.includes(keyword))) {
      groups['Laki - Laki'].items.push(item);
    } else if (perempuanItems.some(keyword => itemName.includes(keyword))) {
      groups['Perempuan'].items.push(item);
    } else if (perlengkapanItems.some(keyword => itemName.includes(keyword))) {
      groups['Perlengkapan Umroh'].items.push(item);
    } else {
      groups['Perlengkapan Umroh'].items.push(item); // Default group
    }
  });
  
  return groups;
}

function openItemsModalFromDetail() {
  if (currentDetailKelengkapanId && typeof openItemsModal === 'function') {
    closeDetailModal();
    openItemsModal(currentDetailKelengkapanId);
  }
}
</script>